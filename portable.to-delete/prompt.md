# Graph Memory Bank (универсальный промпт)

Собери и поддерживай графовую память проекта (Obsidian-стиль) в репозитории, чтобы ИИ-агенты быстро вытягивали минимальный, но точный контекст.

## Жесткие требования

- Пиши по-русски (если не сказано иначе).
- Узлы атомарные: один файл = одна сущность/идея/контракт.
- Узлы маленькие: обычно до 200-300 строк; при росте дели на подузлы.
- В каждом файле YAML frontmatter минимум: `id`, `type`, `title`, `description`, `status`, `tags`.
- Всегда добавляй связи:
  - исходящие ссылки (см. также / зависит / использует)
  - обратные ссылки (где используется / индексы-хабы)
- Секреты не писать в docs (только “где берется”, без значений).
- Generated-файлы не править руками.

## Структура (3 слоя)

По умолчанию создавай `docs/graph/`:
1. `tasks/`: релизы, задачи, коммиты, что менялось.
2. `project/`: архитектура, сущности, контракты, DB, интеграции, “куда смотреть”.
3. `processes/`: как вести граф, качество, генераторы, правила.

## Основной цикл

### 1) Каркас

- Входная точка: `docs/graph/index.md`.
- Индексы слоев: `docs/graph/tasks/index.md`, `docs/graph/project/index.md`, `docs/graph/processes/index.md`.
- В индексах кроме ссылок пиши 6-10 слов “что внутри”.

### 2) Release-driven проход

Для каждого релиза/тэга/ноты:
- найди range (между тэгами/коммитами релиз-нот);
- выпиши список сущностей (задачи, модули, DB миграции, контракты, интеграции);
- создай `release_review` узел;
- для каждой задачи сделай `dev_task` узел с `source_paths` и ссылками на `project/*`.

### 3) Entity-driven проход (универсально)

Определи 5-12 категорий сущностей, релевантных проекту, и обойди их каталогом:
- entrypoints: UI pages/routes, API endpoints, jobs/cron, events/topics
- operations/use-cases: сервисные методы, команды, workflow steps
- data/contracts: таблицы/модели, DTO, OpenAPI/AsyncAPI, схемы сообщений
- integrations: внешние системы, протоколы, таймауты, ретраи, idempotency
- config/feature flags: параметры окружений, фичефлаги
- security: authn/authz, роли/права, аудит
- ops: метрики/логи/трейсинг, алерты, recovery

Для каждой сущности делай кросс-связи между категориями (UI -> API -> service -> DB -> event).

### 4) Поддержка при новых изменениях

На каждый новый коммит/задачу:
- определи затронутые сущности по diff/путям;
- обнови соответствующие узлы: 1-3 предложения сути + ссылки + evidence;
- обнови индексы/backlinks.

